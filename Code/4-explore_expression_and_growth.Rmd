
---
title: "Exploring gene expression and growth"
author: "Mackenzie Johnson"
date: "12/2/2021"
output: html_document
---

This document is the R version of `4-explore_expression_and_growth.ipynb`, created for easier extension of the analysis and figures created by Adam.


```{r, message=FALSE}
library(tidyverse)
library(glue)
library(pheatmap)
library(viridis)
```


## Defining constants and save directories

```{r, message=FALSE}

path_to_data <- '/Users/mackenziejohnson/Documents/grad_school/wilke_lab/Growth-expression-translation/Data/processed_data/'
path_to_figures <- NULL

data_key <- tibble(
  set = c(
    'ecoli_full', 
    'ecoli_sparse', 
    'ecoli_prot',
    'scer_rna', 
    'scer_prot'
  ),
  meta_file = c(
    glue({path_to_data}, 'processed_metadata_ecoli.tsv'),
    glue({path_to_data}, 'processed_metadata_ecoli_SPARSE.tsv'),
    glue({path_to_data}, 'processed_metadata_ecoli_PROTEIN.tsv'),
    glue({path_to_data}, 'processed_metadata_scer_RNA.tsv'),
    glue({path_to_data}, 'processed_metadata_scer_PROTEIN.tsv')
  ),
  expression_file = c(
    glue({path_to_data}, 'processed_expression_ecoli.tsv'),
    glue({path_to_data}, 'processed_expression_ecoli_SPARSE.tsv'),
    glue({path_to_data}, 'processed_expression_ecoli_PROTEIN.tsv'),
    glue({path_to_data}, 'processed_expression_scer_RNA.tsv'),
    glue({path_to_data}, 'processed_expression_scer_PROTEIN.tsv')
  ),
  summary_file = c(
    glue({path_to_data}, 'processed_expression_summary_ecoli.tsv'),
    glue({path_to_data}, 'processed_expression_summary_ecoli_SPARSE.tsv'),
    glue({path_to_data}, 'processed_expression_summary_ecoli_PROTEIN.tsv'),
    glue({path_to_data}, 'processed_expression_summary_scer_RNA.tsv'),
    glue({path_to_data}, 'processed_expression_summary_scer_PROTEIN.tsv')
  )
)

# select dataset for analysis
data_tag <- "ecoli_full"

```


## Read in the data

```{r, message=FALSE}

# get relevant file names for data set of interest
data_key %>% 
  filter(set == data_tag) -> analysis_files

# read in data
meta_df <- read_tsv(analysis_files$meta_file)

exp_df <- read_tsv(analysis_files$expression_file)

exp_sum_df <- read_tsv(analysis_files$summary_file)

```


## Explore the relationship between conditions

```{r, message=FALSE}

# get pearson's correlation coefficient for gene expression between all conditions
cond_cor_mat <- exp_df %>% 
  select(-`log-TPM`) %>% # remove text
  cor(., method = "pearson")

dim(cond_cor_mat)
cond_cor_mat[1:4, 1:4]

```


```{r, message=FALSE}

pheatmap::pheatmap(
  cond_cor_mat,
  color = inferno(100),
  cellheight = 2,
  cellwidth = 2,
  border_color = NA,
  show_rownames = FALSE,
  show_colnames = FALSE,
  clustering_method = "average"
)

```


```{r, message=FALSE, eval=FALSE, include=FALSE}

#ggcorrplot

# works but cannot easily add dendrogram
library(corrplot)
corrplot(
  cond_cor_mat, 
  method = 'color', 
  order = 'hclust',
  tl.pos = 'n', 
  cl.pos = 'r',
  col.lim = c(0,1),
  #col = COL2('PiYG')
  col = colorRampPalette(c("black", "black", "black", 
                           "#440154FF", "#21908CFF", "#FDE725FF"))(50)
)

```

```{r, eval=FALSE, include=FALSE}

# can't add color scale???
heatmap(
  cond_cor_mat, 
  hclustfun = hclust,
  col = colorRampPalette(c("#440154FF", "#21908CFF", "#FDE725FF"))(25),
  symm = TRUE,
  labRow = FALSE,
  labCol = FALSE
)

```

```{r, eval=FALSE, include=FALSE}

# ugly but easy to check individual sets
library(heatmaply)
heatmaply_cor(
  cond_cor_mat,
  limits = c(0,1),
  row_dend_left = TRUE,
  showticklabels = FALSE,
  plot_method = "ggplot"
)

```


```{r}

```



#### Example scatterplots of two highly correlated conditions

```{r}

```


#### Example scatterplots of two minimally correlated conditions

```{r}

```


## Gene expression vs various dispersion metrics

```{r}

```


## Explore growth rate data

```{r}

```


#### Assess individual gene correlations with the growth rate data

```{r}

```


#### Finding representative examples of genes

```{r}

```


## Expression vs growth correlation

```{r}

```





